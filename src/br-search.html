<dom-module id="br-search">

<link rel="import" type="css" href="../dist/css/br-search.min.css">

<template>

  <button class="header--btn close_search" on-click="_close">
    <br-icons icon="br-icons:arrow-back"></br-icons>
  </button>

  <button class="btn__search" on-click="_open">
    <br-icons icon="br-icons:search"></br-icons>
  </button>

  <input type="text" id="inputSearch" class="input__search" placeholder="Busque por um cliente para visualizar sua carteira" on-keyUp="_onKeyPress">

  <div class="overlay" on-click="_close"></div>

  <div class="content">

    <ul class="list">
      <template is="dom-repeat" id="templateList" items="{{filteredOptions}}">
        <li data-id$="{{item.id}}" on-click="_selectItem">{{item.name}}</li>
      </template>
    </ul>

  </div>

</template>

<script>
  Polymer({
    is: 'br-search',

    properties: {
      options: {
        type: Array,
        value: []
      },
      filteredOptions: {
        type: Array,
        readOnly: true,
        value: []
      },
      minLength: Number
    },

    attached: function () {
      if ( this.options ) {
        this._setFilteredOptions( this.options );
        console.log( this.filteredOptions );
      }
    },

    _open: function ( event ) {
      this.$$( 'input' ).focus();
      this.classList.add( 'open' );
      document.querySelector( 'br-header' ).classList.toggle( 'search_opened' );
    },

    _close: function ( event ) {
      this.$.inputSearch.value = '';
      this.classList.remove( 'open' );
      document.querySelector( 'br-header' ).classList.toggle( 'search_opened' );
    },

    _onKeyPress: function ( e ) {
      if ( e.target.value.length >= this.minLength ) {
        this._setFilteredOptions( this._searchItem( this.options, e.target.value ) );
        this._open();
      }
      else if ( e.target.value.length == 0 ) {
        this.classList.remove( 'open' );
      }
    },

    _searchItem: function ( collection, query ) {
      return collection.filter( function ( element ) {
        return element.name.toLowerCase().indexOf( query.toLowerCase() ) !== -1;
      } );
    },

    _selectItem: function ( e, detail ) {
      var item = this.$.templateList.itemForElement( e.target );
      this.fire( 'on-br-search-selected', { item } );

      this._close();
    },

  });
</script>

</dom-module>